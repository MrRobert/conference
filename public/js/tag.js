window.lpTag=window.lpTag||{};lpTag.taglets=lpTag.taglets||{};lpTag._tagv="2.15.0";lpTag.cfg={retry:{count:0,max:3,timeout:1e3},scriptPrefix:"_lpTagScriptId_",count:0};lpTag.log=function(a,b,c){lpTag._logcnt=lpTag._logcnt||0;"undefined"!=typeof lpMTagDebug&&"function"==typeof lpMTagDebug.Display&&lpMTagDebug.Display(a,b,c,lpTag._logcnt);if("undefined"!=typeof lpTaglogListeners)for(var d=0;d<lpTaglogListeners.length;d++)try{lpTaglogListeners[d](a,b,c,lpTag._logcnt)}catch(e){"undefined"!=typeof lpMTagDebug&&"function"==typeof lpMTagDebug.Display&&lpMTagDebug.Display("Exception="+e+" msg="+a,b,c,lpTag._logcnt)}lpTag._logcnt++};lpTag.csds=function(){function a(a){for(var b=0;b<a.length;b++)d[a[b].service]=a[b].baseURI}function b(a){var b=d[a],c="ALL";return b?b:d[c]}function c(){return d}var d=[];return{getDomain:b,setDomains:a,getCSDSMap:c}}();lpTag.getDomain=lpTag.csds.getDomain;lpTag.Events=lpTag.Events||function(a){function b(a,b){for(var c=[],d=0;d<l[a].length;d++)b&&"*"!==l[a][d].appName&&l[a][d].appName!==b||c.push(l[a][d]);if(l["*"])for(var e=0;e<l["*"].length;e++)b&&"*"!==l["*"][e].appName&&l["*"][e].appName!==b||c.push(l["*"][e]);return c}function c(a,b,c){lpTag&&"function"==typeof lpTag.log&&lpTag.log(a,b,c)}function d(a,b){var d=!1;if(!b){c("Ev listen id not spec for unregister","ERROR","Events");return null}for(var e in a)if(a.hasOwnProperty(e))for(var f=0;f<a[e].length;f++)if(a[e][f].id==b){a[e].splice(f,1);c("Ev listen="+b+" and name="+e+" unregister","DEBUG","Events");d=!0;break}d||c("Ev listen not found "+b+" unregister","DEBUG","Events");return d}function e(a,b,d){return function(){try{a.func.call(a.context,b,d);b=null;a.triggerOnce&&p.unbind(a);a=null}catch(e){c("Error executing "+d.eventName+" eventId: "+a.id+"e="+e.message,"ERROR","Events")}}}function f(a,b,d,e){for(var f=[],g=0;g<a.length;g++)try{var h=!d&&a[g].func===b,i=!b&&d&&a[g].context===d,j=b&&d&&a[g].func===b&&a[g].context===d,k=e&&e===a[g].appName,l="*"===a[g].appName;if(h||i||j){if(k||l)continue}else if(!b&&!d&&k)continue;f.push(a[g])}catch(m){c("Error in unbind e="+m.message,"ERROR","Events")}return f}function g(a){if(0===j||a.data&&a.data.doNotStore)a=null;else{var b={eventName:a.eventName,appName:a.appName};b.data=a.passDataByRef?a.data:h(a.data);if(j>0){o>=j&&(o=0);m[o]=b;o++}else m.push(b);a=null}}function h(a){var b={};if(a.constructor===Object)for(var c in a)a.hasOwnProperty(c)&&null!==a[c]&&void 0!==a[c]&&("object"==typeof a[c]&&a[c].constructor!==Array?b[c]=h(a[c]):a[c].constructor===Array?b[c]=a[c].slice(0)||[]:"function"!=typeof a[c]&&(b[c]=null!==a[c]&&void 0!==a[c]?a[c]:""));else a.constructor===Array?b=a.slice(0)||[]:"function"!=typeof a&&(b=a);return b}if(this===window)return!1;var i,j,k=0,l={},m=[],n="evId_",o=0;i=a&&"boolean"==typeof a.cloneEventData?a.cloneEventData:!1;j=a&&!isNaN(a.eventBufferLimit)?a.eventBufferLimit:-1;var p={once:function(a){if(!a)return null;a.triggerOnce=!0;this.bind(a)},bind:function(a,b,d){var e=a;"string"==typeof a&&(e={appName:a,eventName:b,func:d});if(!e.eventName||!e.func||"function"!=typeof e.func&&e.func.constructor!==Array){c("Ev listen has invalid params: evName=["+e.eventName+"]","ERROR","Events");return null}if(e.func.constructor===Array){for(var f,g,i=[],j=0;j<e.func.length;j++){f=h(e);f.func=e.func[j];g=this.register(f);i.push(g)}return i}var m=n+k++,o={id:m,func:e.func,context:e.context||null,aSync:e.aSync?!0:!1,appName:e.appName||"*",triggerOnce:e.triggerOnce||!1};l[e.eventName]=l[e.eventName]||[];l[e.eventName].push(o);c("Ev listen rgstr: evName=["+e.eventName+"] aSync="+o.aSync+" appName="+o.name,"DEBUG","Events");e=null;a=null;return m},unbind:function(a){var b,e=!1;if(!a){c("Ev listen id not spec for unbind","ERROR","Events");return null}if("string"==typeof a)d(l,a);else if(!a.func&&!a.context&&!a.appName)return!1;var g=l;if(a.eventName){g={};g[a.eventName]=l[a.eventName]}for(var h in g)if(g.hasOwnProperty(h)){b=f(g[h],a.func,a.context,a.appName);if(b.length!==g[h].length){l[h]=b;e=!0}}return e},hasFired:function(a,b){if(("undefined"==typeof b||"*"===b)&&"*"===a)return m;for(var c=[],d=0;d<m.length;d++)(m[d].eventName===b||"*"===b)&&(a&&a===m[d].appName||!m[d].appName||"*"===m[d].appName||"*"===a)&&c.push(m[d]);return c},trigger:function(a,d,f){var j=a;"string"==typeof a&&(j={eventName:d,appName:a,data:f});if(!j||"undefined"==typeof j.eventName){c("Ev name not spec for publish","ERROR","Events");j=null;return null}j.passDataByRef=j.passDataByRef||!i;g(j);if(!l[j.eventName])return!1;var k=b(j.eventName,j.appName);if(k.length>0)for(var m=0;m<k.length;m++){var n=j.passDataByRef?j.data:h(j.data),o={appName:j.appName,eventName:j.eventName},p=k[m];p.aSync||n&&n.aSync?setTimeout(e(p,n,o),0):e(p,n,o)()}j=null;return k.length>0}};p.publish=p.trigger;p.register=p.bind;p.unregister=p.unbind;return p};lpTag.eventsFactory=function(){var a=new lpTag.Events,b=a.trigger,c=!1;a.trigger=function(a,d,e){var f=a;"string"==typeof a&&(f={eventName:d,appName:a,data:e});if("LPT"===f.appName&&"DOM_READY"===f.eventName){if(c)return;c=!0}"undefined"!=typeof lpTag._deferExecuted?b(f):lpTag.defer(function(){b(f)},1)};return a};lpTag.events=lpTag.eventsFactory();lpTag.tglMng=function(){function run(a){_createTaglets(a);try{a=_sortIncludes(a)}catch(b){lpTag.log("Exception in _manageIncludes:"+b,"ERROR","LPTAG")}_initTaglets(a);_execDefers();lpTag.events.trigger("LPTAG","ON_READY");_startTaglets(a);lpTag.events.trigger("LPTAG","ON_STARTED")}function _sortIncludes(a){for(var b=[],c={},d=0;d<a.length;d++){var e=lpTag.taglets[a[d].name];"undefined"!=typeof e.includes&&"undefined"==typeof e.includes.length&&(e.includes=[e.includes]);c[a[d].name]=lpTag.taglets[a[d].name].includes}for(var f=0,g=!0;g;){f++;g=!1;for(var h in c){if("undefined"==typeof c[h]||"undefined"!=typeof c[h]&&0===c[h].length){b.push(_getTaglet(a,h));delete c[h];c=_removeFromIncludes(c,h)}g=!0}if(f>a.length+1){var i="";try{for(var j in c){i+="# tgl=["+j+"] missing -> ";for(var k=0;k<c[j].length;k++)i+=" "+c[j][k].name}}catch(l){lpTag.log("Exception in sortInclude:"+l,"ERROR","LPTAG")}lpTag.log("Missing/circular includes:"+i,"ERROR","LPTAG");g=!1}}return b}function _getTaglet(a,b){for(var c=0;c<a.length;c++)if(a[c].name==b)return a[c];return void 0}function _removeFromIncludes(a,b){for(var c in a){var d=a[c];if("undefined"!=typeof d){for(var e=[],f=0;f<d.length;f++)d[f].name!=b&&e.push(d[f]);a[c]=e}}return a}function _createTaglets(taglets){for(var i=0;i<taglets.length;i++)try{lpTag.log("Processing taglet: "+taglets[i].name,"DEBUG","LPTAG");eval(taglets[i].code)}catch(e){lpTag.log("Error creating taglet:"+taglets[i].name+"  e="+e,"ERROR","LPTAG")}}function _initTaglets(a){for(var b=0;b<a.length;b++){var c=lpTag.taglets[a[b].name];try{lpTag.log("Init taglet: "+a[b].name,"DEBUG","LPTAG");c.init(a[b].parameters)}catch(d){lpTag.log("Error init taglet:"+a[b].name+"  e="+d,"ERROR","LPTAG")}}}function _execDefers(){lpTag._deferExecuted=!0;lpTag.defer=function(a){try{a()}catch(b){lpTag.log("Error executing defer fn:"+b,"ERROR","LPTAG")}};_execDeferArr(lpTag._defB);_execDeferArr(lpTag._defT);_execDeferArr(lpTag._defL)}function _execDeferArr(a){if("undefined"!=typeof a){for(var b=0;b<a.length;b++)try{a[b]()}catch(c){lpTag.log("Error executing defer fn:"+c,"ERROR","LPTAG")}a.length=0}}function _startTaglets(a){for(var b=0;b<a.length;b++){var c=lpTag.taglets[a[b].name];try{if("function"==typeof c.start){lpTag.log("Start taglet: "+a[b].name,"DEBUG","LPTAG");c.start()}lpTag.events.trigger("LPTAG","TAGLET_STARTED",{name:a[b].name})}catch(d){lpTag.log("Error start taglet :"+a[b].name+"e= "+d,"ERROR","LPTAG")}}}return{run:run}}();lpTag.device=function(){function a(){return u}function b(){return v}function c(){return l[v]}function d(){return j[u]}function e(){var a=i.desktop;n&&!o?a=i.mobile:!o&&!t||g()?o&&g()&&p&&(a=i.tablet):a=i.tablet;return a}function f(){var a=k.windows;q&&!n?a=k.mac:t?a=k.android:s?a=k.iOS:r&&(a=k.linux);return a}function g(){var a,b=!1,c=document.documentMode;a=/*@cc_on!@*/b;if(!a){try{document.documentMode=""}catch(d){}a="number"==typeof document.documentMode;try{document.documentMode=c}catch(d){}}!a&&navigator&&navigator.userAgent&&(a="Netscape"===navigator.appName&&/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/.test(navigator.userAgent));return a}function h(a){var b={};for(var c in a)b[c]=a[c];return b}var i={desktop:0,tablet:1,mobile:2},j=["Desktop","Tablet","Mobile"],k={windows:0,mac:1,linux:2,iOS:3,android:4},l=["Windows","Mac OSX","Linux","iOS","Android"],m=navigator.userAgent,n=m.match(/(Windows Phone|iPhone|iPod|mobile|Mobile|IEMobile)/g)?!0:!1,o=m.match(/(Tablet PC|iPad|Tablet|tablet)/g)?!0:!1,p=m.match(/(Touch)/g)?!0:!1,q=m.match(/(Mac OS)/g)?!0:!1,r=m.match(/(Linux)/g)?!0:!1,s=m.match(/(iPhone|iPod|iPad)/g)?!0:!1,t=m.match(/(android|Android)/g)?!0:!1,u=e(),v=f();return{os:b,osEnum:h(k),osName:c,family:a,familyEnum:h(i),familyName:d}}();lpTag.start=function(){lpTag.load(lpTag.protocol+"//"+(lpTag.ovr&&lpTag.ovr.tagjs?lpTag.ovr.tagjs:"tags.liveperson.net")+"/lptag/api/account/"+lpTag.site+"/configuration/applications/taglets/.jsonp"+(lpTag.section?"?s="+lpTag.section:""),"UTF-8",lpTag.cfg.scriptPrefix+lpTag.cfg.count);lpTag.cfg.count++};lpTag.retries=0;lpTag.callback=function(a){function b(a){var b=document.getElementById(a);if(b)try{b.parentNode.removeChild(b);for(var c in b)b.hasOwnProperty(c)&&delete b[c]}catch(d){lpTag.log("error removing script: "+a,"ERROR","LPTAG")}}try{var c=lpTag.cfg.retry;if(a.retry){var d=lpTag.cfg.count-1;b(lpTag.cfg.scriptPrefix+d);isNaN(a.retry.maxRetries)||(c.max=parseInt(a.retry.maxRetries,10));isNaN(a.retry.timeout)||(c.timeout=parseInt(a.retry.timeout,10));if(c.count<c.max){lpTag.log("retrying count="+c.count+" max="+c.max,"DEBUG","LPTAG");c.count++;var e=this;setTimeout(function(){e.start()},c.timeout)}else lpTag.log("exceeded max retries: "+c.max+", stopping","ERROR","LPTAG")}else{c.count=0;lpTag.csds.setDomains(a.serviceMap);lpTag.tglMng.run(a.taglets)}}catch(f){lpTag.log("callback has failed "+f,"ERROR","LPTAG")}};lpTag.run=function(){"undefined"!=typeof window._lptTagStop||"undefined"!=typeof lpTag.autoStart&&!lpTag.autoStart||lpTag.start()};lpTag.run();